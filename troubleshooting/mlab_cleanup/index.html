<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">

	<title>mLab - Loop Docs</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/base.css" rel="stylesheet">
        <link href="../../css/admonitions.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../..">Loop Docs</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="../..">Home</a>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Setup <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../../setup/overview/">Overview</a>
</li>

                    
                        
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Requirements</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../setup/requirements/pump/">Insulin Pump</a>
</li>

        
            
<li >
    <a href="../../setup/requirements/cgm/">CGM</a>
</li>

        
            
<li >
    <a href="../../setup/requirements/rileylink/">RileyLink</a>
</li>

        
            
<li >
    <a href="../../setup/requirements/computer/">Computer</a>
</li>

        
            
<li >
    <a href="../../setup/requirements/iphone/">iPhone</a>
</li>

        
            
<li >
    <a href="../../setup/requirements/appledev/">Apple Developer</a>
</li>

        
    </ul>
  </li>

                    
                        
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Build and Install</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../setup/build/installing/">Installing</a>
</li>

        
            
<li >
    <a href="../../setup/build/build_errors/">Build Errors</a>
</li>

        
            
<li >
    <a href="../../setup/build/code_customization/">Code Customization</a>
</li>

        
            
<li >
    <a href="../../setup/build/configuration/">Configuration</a>
</li>

        
            
<li >
    <a href="../../setup/build/updating/">Updating</a>
</li>

        
    </ul>
  </li>

                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Operation <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../../operation/overview/">App Screens</a>
</li>

                    
                        
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">How To Loop</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../operation/loop/open-loop/">Open Loop</a>
</li>

        
            
<li >
    <a href="../../operation/loop/close-loop/">Closed Loop</a>
</li>

        
            
<li >
    <a href="../../operation/loop/green-loop/">Getting a Green Loop</a>
</li>

        
    </ul>
  </li>

                    
                        
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Features</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../operation/features/watch/">Apple Watch</a>
</li>

        
            
<li >
    <a href="../../operation/features/bolus/">Bolus</a>
</li>

        
            
<li >
    <a href="../../operation/features/carbs/">Carb Entries</a>
</li>

        
            
<li >
    <a href="../../operation/features/healthapp/">Health App</a>
</li>

        
            
<li >
    <a href="../../operation/features/widget/">iPhone widget</a>
</li>

        
            
<li >
    <a href="../../operation/features/notifications/">Loop Notifications</a>
</li>

        
            
<li >
    <a href="../../operation/features/workout/">Workout Targets</a>
</li>

        
    </ul>
  </li>

                    
                        
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Algorithm</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../operation/algorithm/overview/">Overview</a>
</li>

        
            
<li >
    <a href="../../operation/algorithm/bolus/">Bolus Recommendations</a>
</li>

        
            
<li >
    <a href="../../operation/algorithm/prediction/">Glucose Prediction</a>
</li>

        
            
<li >
    <a href="../../operation/algorithm/temp_basal/">Temp Basal Adjustments</a>
</li>

        
    </ul>
  </li>

                    
                        
<li >
    <a href="../../operation/new-version/">New Version Info</a>
</li>

                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Troubleshooting <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../overview/">Overview</a>
</li>

                    
                        
<li class="active">
    <a href="./">mLab</a>
</li>

                    
                        
<li >
    <a href="../priming/">Priming and Sites</a>
</li>

                    
                        
<li >
    <a href="../rileylink/">RileyLink</a>
</li>

                    
                        
<li >
    <a href="../time-change/">Time Changes</a>
</li>

                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Nightscout <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../../nightscout/overview/">Overview</a>
</li>

                    
                        
<li >
    <a href="../../nightscout/new_user/">Setup New Site</a>
</li>

                    
                        
<li >
    <a href="../../nightscout/update_user/">Update Site</a>
</li>

                    
                        
<li >
    <a href="../../nightscout/azure_migration/">Azure to Heroku</a>
</li>

                    
                        
<li >
    <a href="../../nightscout/loop_pill/">Loop Pill</a>
</li>

                    
                        
<li >
    <a href="../../nightscout/ifttt/">IFTTT</a>
</li>

                    
                        
<li >
    <a href="../../nightscout/pebble/">Pebble</a>
</li>

                    
                        
<li >
    <a href="../../nightscout/pushover/">Remote Notifications</a>
</li>

                    
                        
<li >
    <a href="../../nightscout/reports/">Reports</a>
</li>

                    
                    </ul>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                <li >
                    <a rel="next" href="../overview/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../priming/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#mlab-database-maintenance">mLab Database Maintenance</a></li>
        
            <li><a href="#cleanout-mlab">Cleanout mLab</a></li>
        
            <li><a href="#compact-mlab">Compact mLab</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="mlab-database-maintenance">mLab Database Maintenance<a class="headerlink" href="#mlab-database-maintenance" title="Permanent link">‚åÅ</a></h1>
<p>Regardless of whether you are on Azure or Heroku for Nightscout, you are using an mLab database for storing your Loop data.  mLab allows you to store up to 500 MB for free.  When you hit that data cap, your NS will stop working.  Your Share Bridge will not pull data and your site will be ‚Äústale‚Äù.  </p>
<p>The good news?  Loop can still run just fine until you cleanout and/or compact your mLab database.  The bad news?  You just won‚Äôt be able to remotely monitor Loop through NS until you clear up some storage space in mLab.</p>
<p>Note there are two areas where the 500 MB data limit can be an issue.  One is called the <code>size</code> which is the actual data stored in your database.  The other is called <code>size on disk</code> which is the virtual space that your database takes up.  As data is written onto your free database, sometimes it is written inefficiently and virtually "spreads out" to take up more room.  Depending on where your issue is, you may need to delete or cleanout data (if <code>size</code> is the issue) or you may just need to compact data (if <code>size on disk</code> is the issue).</p>
<p align="center">
<img src="../img/mlab_size2.jpg" width="650">
</p>

<h2 id="cleanout-mlab">Cleanout mLab<a class="headerlink" href="#cleanout-mlab" title="Permanent link">‚åÅ</a></h2>
<p>There are two ways to cleanout space and delete data in your mLab database:</p>
<ul>
<li>mLab direct access</li>
<li>Nightscout admin tools</li>
</ul>
<h3 id="mlab-direct-access">mLab Direct Access<a class="headerlink" href="#mlab-direct-access" title="Permanent link">‚åÅ</a></h3>
<ul>
<li>
<p>Login to your mLab database.  </p>
<ul>
<li>
<p>If you setup your own Azure site and mLab database, go directly to <a href="http://mlab.com">mLab</a> and login, or</p>
</li>
<li>
<p>If you setup your own Azure site and mLab database, then setup a Heroku account and pointed back to your old mLab database (i.e., copy and pasted the MONGODB_URI from Azure), go directly to <a href="http://mlab.com">mLab</a> and login, or</p>
</li>
<li>
<p>If you setup a Heroku site and let Heroku setup an mLab database for you (which is typical for new Heroku sites), you will access mLab through your Heroku account main page.   Login to your Heroku account and click on the mLab logo as shown below.</p>
</li>
</ul>
</li>
</ul>
<p align="center">
<img src="../img/mlab_link.jpg" width="650">
</p>

<ul>
<li>
<p>(Users coming directly from a Heroku click will see the screen below.  If you had to login to mLab with a name and password, you will first see a line with your MongoDB database.  Click on your database name to see the screen below with all the collection names.) </p>
<p>Your various collections are shown, similar to the screen shot below.  The amount of data each collection is using is listed to the far right of each collection‚Äôs line.  I recommend emptying the ‚Äúloop‚Äù collection first and then "devicestatus" to free up database storage.  If you need any of the information in the database, you may want to do a selective delete of data. For example, if you are headed into an endocrinologist appointment and want to print out recent Nightscout reports to take with you. Eventually you may need to empty more collections.  It should be awhile though, as the other collections are significantly smaller and will take a long time to fill.</p>
<p>Click on a collection‚Äôs name to open it.</p>
</li>
</ul>
<p align="center">
<img src="../img/mlab_collections.jpg" width="650">
</p>

<ul>
<li>Click on the button that says ‚ÄúDelete all documents in collection‚Äù and then confirm the deletion.</li>
</ul>
<p align="center">
<img src="../img/mlab_delete.jpg" width="650">
</p>

<ul>
<li>You can confirm that your cleanout has resolved the problem, by checking that your database size is below 500 MB now.  Click on the <code>Home</code> link in top left.  Then review the size of the database as shown.</li>
</ul>
<p align="center">
<img src="../img/mlab_size.jpg" width="650">
</p>

<h3 id="nightscout-admin-tools">Nightscout Admin Tools<a class="headerlink" href="#nightscout-admin-tools" title="Permanent link">‚åÅ</a></h3>
<p>If you go to your Nightscout site's settings (the three horizontal bars in the upper right of your Nightscout site), you will be able to access your Admin Tools for the site.  These include some useful quick mLab actions, includig deleting documents from the devicestatus collection similar to the action we took in the steps above.  But, it's worth noting that if you have errant future data in your Nightscout site that is causing problems (usually during time changes or overseas travel), you can clean-out future entries through this portal, too.</p>
<p align="center">
<img src="../img/mlab_admin_tools.jpg" width="650">
</p>

<h2 id="compact-mlab">Compact mLab<a class="headerlink" href="#compact-mlab" title="Permanent link">‚åÅ</a></h2>
<p>You may get an email from mLab, even after cleaning out enough space in your database, alerting you that your "file size limit" may have been exceeded. </p>
<p align="center">
<img src="../img/mlab_compact.jpg" width="650">
</p>

<p>To begin the compaction process, click on your database name.</p>
<p align="center">
<img src="../img/mlab_compact1.png" width="650">
</p>

<p>Then click on the <code>Tools</code> tab in the screen that opens.  Click on the <code>commands</code> button and then select the <code>repairDatabase</code> from the dropdown menu of available commands.  At the bottom of the screen, select the <code>Run Command</code> button. </p>
<p align="center">
<img src="../img/mlab_compact2.png" width="650">
</p>

<p>Return to your home screen and you will be able to verify the <code>Size on Disk</code> has decreased.</p>
<p align="center">
<img src="../img/mlab_compact3.png" width="650">
</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            
            <center>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</center>
        </footer>

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>